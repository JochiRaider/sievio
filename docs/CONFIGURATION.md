# Sievio Configuration Reference

> Generated by `scripts/generate_configuration_md.py` from `sievio.core.config`. Do not edit by hand.

## SievioConfig

Declarative spec for a Sievio run.

    This object must remain purely declarative and serializable: it can
    hold only configuration knobs and derived scalar/string/path values.
    Anything that is callable, holds open resources, or maintains
    runtime state (HTTP clients, Source/Sink instances, file
    extractors, bytes handlers, QC scorers, plugins, executors, etc.)
    must live in PipelineRuntime or other ephemeral wiring, never on
    this spec. Derived declarative fields such as normalized modes,
    resolved primary JSONL names, or output directories are allowed.

    Safety and PII filtering is configured under ``qc.safety`` and
    follows the same execution modes as general QC.

| Field | Type | Default |
| --- | --- | --- |
| `sources` | `SourceConfig` | `<factory SourceConfig>` |
| `decode` | `DecodeConfig` | `<factory DecodeConfig>` |
| `chunk` | `ChunkConfig` | `<factory ChunkConfig>` |
| `language` | `LanguageIDConfig` | `<factory LanguageIDConfig>` |
| `code_lang` | `CodeLanguageConfig` | `<factory CodeLanguageConfig>` |
| `pipeline` | `PipelineConfig` | `<factory PipelineConfig>` |
| `sinks` | `SinkConfig` | `<factory SinkConfig>` |
| `http` | `HttpConfig` | `<factory HttpConfig>` |
| `qc` | `QCConfig` | `<factory QCConfig>` |
| `logging` | `LoggingConfig` | `<factory LoggingConfig>` |
| `metadata` | `RunMetadata` | `<factory RunMetadata>` |
| `dataset_card` | `DatasetCardConfig` | `<factory DatasetCardConfig>` |

## ChunkConfig

Configuration for text chunking behavior.

    Attributes:
        policy (ChunkPolicy): Chunking policy instance used to split
            decoded text into records.
        tokenizer_name (str | None): Optional tokenizer identifier used
            for token-based policies.
        attach_language_metadata (bool): Whether detected language
            metadata is attached to records.

| Field | Type | Default |
| --- | --- | --- |
| `policy` | `ChunkPolicy` | `<factory ChunkPolicy>` |
| `tokenizer_name` | `Union[str, NoneType]` | `None` |
| `attach_language_metadata` | `bool` | `True` |

## ChunkPolicy

Configuration for chunking text into token-bounded spans.

    Attributes:
        mode (str): Chunking mode, ``"doc"`` for documentation
            style text or ``"code"`` for source code.
        target_tokens (int): Desired token count for each chunk.
        overlap_tokens (int): Number of tokens to overlap between
            consecutive chunks.
        min_tokens (int): Minimum token count for a chunk before
            it will be flushed.
        semantic_doc (bool): Whether to apply optional paragraph
            and sentence-aware refinement in documentation mode.
        semantic_tokens_per_block (int | None): Target token count
            for semantic sub-blocks when ``semantic_doc`` is True.

| Field | Type | Default |
| --- | --- | --- |
| `mode` | `str` | `'doc'` |
| `target_tokens` | `int` | `1700` |
| `overlap_tokens` | `int` | `40` |
| `min_tokens` | `int` | `400` |
| `semantic_doc` | `bool` | `False` |
| `semantic_tokens_per_block` | `Union[int, NoneType]` | `None` |

## CodeLanguageConfig

Settings for code-language detection and hints.

| Field | Type | Default |
| --- | --- | --- |
| `enabled` | `bool` | `True` |
| `backend` | `str` | `'baseline'` |
| `hints` | `LanguageConfig` | `<factory LanguageConfig>` |

## CsvSourceConfig

Default settings for reading text from CSV files.

    Attributes:
        default_text_column (str): Column name used as the text field
            when none is specified.
        default_delimiter (str | None): Delimiter override; when None
            the CSV sniffer is used.
        encoding (str): Text encoding used to decode CSV bytes.

| Field | Type | Default |
| --- | --- | --- |
| `default_text_column` | `str` | `'text'` |
| `default_delimiter` | `Union[str, NoneType]` | `None` |
| `encoding` | `str` | `'utf-8'` |

## DatasetCardConfig

Configuration for generating dataset cards.

    Attributes:
        enabled (bool): Whether to emit a dataset card.
        split_name (str): Default split name associated with the
            generated dataset.
        license (str | Sequence[str] | None): License identifier or
            identifiers for the dataset.
        task_categories (str | Sequence[str] | None): High-level task
            categories (e.g. "text-generation").
        task_ids (str | Sequence[str] | None): Fine-grained task ids.
        tags (str | Sequence[str] | None): Additional tags for the
            dataset card.

| Field | Type | Default |
| --- | --- | --- |
| `enabled` | `bool` | `True` |
| `split_name` | `str` | `'train'` |
| `license` | `Union[str, Sequence[str], NoneType]` | `None` |
| `task_categories` | `Union[str, Sequence[str], NoneType]` | `None` |
| `task_ids` | `Union[str, Sequence[str], NoneType]` | `None` |
| `tags` | `Union[str, Sequence[str], NoneType]` | `None` |

## DecodeConfig

Text decoding and normalization options.

    Attributes:
        normalize (str | None): Unicode normalization form (e.g. "NFC")
            or None to disable normalization.
        strip_controls (bool): Whether to strip control characters from
            decoded text.
        fix_mojibake (bool): Whether to attempt simple mojibake fixes.
        max_bytes_per_file (int | None): Soft cap on bytes passed to the
            decoder per file.

| Field | Type | Default |
| --- | --- | --- |
| `normalize` | `Union[str, NoneType]` | `'NFC'` |
| `strip_controls` | `bool` | `True` |
| `fix_mojibake` | `bool` | `True` |
| `max_bytes_per_file` | `Union[int, NoneType]` | `None` |

## GitHubSourceConfig

Configuration for reading sources from GitHub archives.

    Attributes:
        per_file_cap (int | None): Maximum uncompressed bytes to extract
            per member file.
        max_total_uncompressed (int): Maximum total uncompressed bytes
            across all members.
        max_members (int): Maximum number of archive members to inspect.
        max_compression_ratio (float): Safety limit for compressed vs.
            uncompressed size.
        include_exts (set[str] | None): Optional whitelist of file
            extensions to include.
        exclude_exts (set[str] | None): Optional blacklist of file
            extensions to exclude.

| Field | Type | Default |
| --- | --- | --- |
| `per_file_cap` | `Union[int, NoneType]` | `209715200` |
| `max_total_uncompressed` | `int` | `2147483648` |
| `max_members` | `int` | `200000` |
| `max_compression_ratio` | `float` | `100.0` |
| `include_exts` | `Union[set[str], NoneType]` | `None` |
| `exclude_exts` | `Union[set[str], NoneType]` | `None` |

## HttpConfig

HTTP client settings used by higher-level helpers and factories.

    - ``client`` can hold a pre-built SafeHttpClient instance. When set,
    it will be reused by ``build_client()`` and passed to factories.
    - ``as_global`` controls whether the builder installs this client as
    the module-wide default via ``set_global_http_client``. For
    CLI-style one-shot runs, leaving this True is convenient. For
    tests or long-lived processes, prefer ``as_global=False`` and
    pass the client explicitly.

| Field | Type | Default |
| --- | --- | --- |
| `timeout` | `float` | `60.0` |
| `max_redirects` | `int` | `5` |
| `allowed_redirect_suffixes` | `tuple[str, Ellipsis]` | `('github.com',)` |
| `client` | `Union[SafeHttpClient, NoneType]` | `None` |
| `as_global` | `bool` | `True` |

## LanguageConfig

Configurable file-type and language hints.

| Field | Type | Default |
| --- | --- | --- |
| `code_exts` | `set[str]` | `<factory <lambda>>` |
| `doc_exts` | `set[str]` | `<factory <lambda>>` |
| `ext_lang` | `dict[str, str]` | `<factory <lambda>>` |
| `display_names` | `dict[str, str]` | `<factory <lambda>>` |

## LanguageIDConfig

Settings for human-language detection.

| Field | Type | Default |
| --- | --- | --- |
| `enabled` | `bool` | `True` |
| `backend` | `str` | `'baseline'` |

## LocalDirSourceConfig

Configuration options for local directory sources.

    Attributes:
        include_exts (set[str] | None): File extensions to include.
            When set, only files with these lowercase suffixes are
            processed.
        exclude_exts (set[str] | None): File extensions to exclude.
        skip_hidden (bool): Whether to skip dotfiles and hidden paths.
        follow_symlinks (bool): Whether to traverse symbolic links.
        respect_gitignore (bool): Whether to honor .gitignore patterns.
        max_file_bytes (int | None): Hard cap on bytes read per file.
        read_prefix_bytes (int | None): If set, only read this many
            bytes from each file.
        read_prefix_for_large_files_only (bool): When True, apply
            ``read_prefix_bytes`` only to files larger than that limit.

| Field | Type | Default |
| --- | --- | --- |
| `include_exts` | `Union[set[str], NoneType]` | `None` |
| `exclude_exts` | `Union[set[str], NoneType]` | `None` |
| `skip_hidden` | `bool` | `True` |
| `follow_symlinks` | `bool` | `False` |
| `respect_gitignore` | `bool` | `True` |
| `max_file_bytes` | `Union[int, NoneType]` | `209715200` |
| `read_prefix_bytes` | `Union[int, NoneType]` | `None` |
| `read_prefix_for_large_files_only` | `bool` | `True` |

## LoggingConfig

Controls the package logger; set propagate=True/logger_name to
    integrate with host apps.

| Field | Type | Default |
| --- | --- | --- |
| `level` | `UnionType[int, str]` | `'INFO'` |
| `propagate` | `bool` | `False` |
| `fmt` | `Union[str, NoneType]` | `'%(asctime)s %(levelname)s %(name)s: %(message)s'` |
| `logger_name` | `str` | `'sievio'` |

## PdfSourceConfig

Settings for web PDF fetching; download_* controls concurrency for WebPdfListSource/WebPagePdfSource only.

    download_executor_kind:
        "thread" only; "process" is currently not supported for web downloads and will
        fall back to "thread" with a warning.

| Field | Type | Default |
| --- | --- | --- |
| `timeout` | `int` | `60` |
| `max_pdf_bytes` | `int` | `209715200` |
| `max_links` | `int` | `200` |
| `require_pdf` | `bool` | `True` |
| `include_ambiguous` | `bool` | `False` |
| `retries` | `int` | `1` |
| `user_agent` | `str` | `'sievio/0.1 (+https://github.com/jochiraider/sievio)'` |
| `client` | `Union[SafeHttpClient, NoneType]` | `None` |
| `download_max_workers` | `int` | `4` |
| `download_submit_window` | `Union[int, NoneType]` | `None` |
| `download_executor_kind` | `str` | `'thread'` |

## PipelineConfig

Controls pipeline concurrency and processing behavior.

    max_workers = 0 → auto (os.cpu_count or 1)
    submit_window = None → defaults to max_workers * 4
    executor_kind ∈ {"thread", "process", "auto"}
      - "thread": good for I/O-heavy or small text/code workloads.
      - "process": recommended for CPU-bound handlers such as PDF (pdfio) or EVTX (evtxio).
      - "auto": let the pipeline choose based on configured sources/handlers (defaults to
        threads for mostly text/code; switches to processes when PDF/EVTX-heavy).

    Where this applies:
    - main extraction pipeline (file decoding/chunking/sink writes)
    - defaults for post-QC when QCConfig.parallel_post is True and no QC overrides are set
    Does not control web PDF fetch concurrency (see PdfSourceConfig.download_*).

| Field | Type | Default |
| --- | --- | --- |
| `extractors` | `Sequence[Extractor]` | `<factory tuple>` |
| `file_extractor` | `Union[FileExtractor, NoneType]` | `None` |
| `bytes_handlers` | `Sequence[tuple[Callable[[<class 'bytes'>, <class 'str'>], bool], Callable[[<class 'bytes'>, <class 'str'>, typing.Optional[sievio.core.interfaces.RepoContext], typing.Optional[sievio.core.chunk.ChunkPolicy]], Union[Iterable[Mapping[str, Any]], NoneType]]]]` | `<factory tuple>` |
| `max_workers` | `int` | `0` |
| `submit_window` | `Union[int, NoneType]` | `None` |
| `fail_fast` | `bool` | `False` |
| `executor_kind` | `str` | `'auto'` |
| `max_error_rate` | `Union[float, NoneType]` | `None` |

## PromptConfig

Settings used when generating prompt-oriented outputs.

    Attributes:
        heading_fmt (str): Format string for per-chunk headings.
        include_prompt_file (bool): Whether to include a combined prompt
            file alongside JSONL outputs.

| Field | Type | Default |
| --- | --- | --- |
| `heading_fmt` | `str` | `'### {path} [chunk {chunk}]'` |
| `include_prompt_file` | `bool` | `True` |

## QCConfig

Configuration for quality scoring and gating.

    Set ``enabled=True`` and pick a ``mode`` from :class:`QCMode`:

    * ``INLINE``: Score records during extraction and drop those failing
    thresholds.
    * ``ADVISORY``: Score inline but never drop; adds QC metadata for
    review.
    * ``POST``: Do not enforce QC gates inline; QC thresholds are
    enforced only in a post-QC pass. QC may still evaluate inline when
    required (for example, to supply features to safety scoring).
    * ``OFF``: Disable QC entirely.

    Semantics:
    * ``enabled=False`` → QC is off regardless of mode.
    * ``enabled=True`` with mode in {"inline", "advisory"} → requires
    either a resolved scorer (``qc.scorer``) or a scorer id
    (``qc.scorer_id``) at config time; the builder resolves
    ``scorer_id`` later and fails if QC extras are missing.
    * ``enabled=True`` with mode="post" → QC gating happens only in the
    post-hoc pass; QC may still compute inline when needed. A scorer is
    optional; if QC extras are missing, QC is skipped with a warning.

    Concurrency:
    * ``parallel_post`` enables post-QC scoring via
    ``process_items_parallel``.
    * ``post_*`` knobs override pipeline concurrency for post-QC; when
    None, they inherit from :class:`PipelineConfig`.

| Field | Type | Default |
| --- | --- | --- |
| `enabled` | `bool` | `False` |
| `write_csv` | `bool` | `False` |
| `csv_suffix` | `str` | `'_quality.csv'` |
| `write_signals_sidecar` | `bool` | `False` |
| `signals_suffix` | `UnionType[str, NoneType]` | `None` |
| `signals_format` | `Literal['csv', 'parquet']` | `'csv'` |
| `scorer` | `Union[Any, NoneType]` | `None` |
| `scorer_id` | `Union[str, NoneType]` | `None` |
| `scorer_options` | `dict[str, Any]` | `<factory dict>` |
| `heuristics` | `Union[QCHeuristics, NoneType]` | `None` |
| `fail_on_error` | `bool` | `False` |
| `min_score` | `Union[float, NoneType]` | `60.0` |
| `drop_near_dups` | `bool` | `False` |
| `exact_dedup` | `bool` | `True` |
| `mode` | `str` | `'inline'` |
| `parallel_post` | `bool` | `False` |
| `post_executor_kind` | `Union[str, NoneType]` | `None` |
| `post_max_workers` | `Union[int, NoneType]` | `None` |
| `post_submit_window` | `Union[int, NoneType]` | `None` |
| `safety` | `SafetyConfig` | `<factory SafetyConfig>` |

## QCHeuristics

Tunable thresholds and weights used by quality scoring.

    Defaults match existing hard-coded behavior and can be overridden
    per-run via ``QCConfig.scorer_options["heuristics"]``.

| Field | Type | Default |
| --- | --- | --- |
| `target_code_min` | `int` | `2000` |
| `target_code_max` | `int` | `4000` |
| `target_log_min` | `int` | `1000` |
| `target_log_max` | `int` | `2000` |
| `target_text_min` | `int` | `1500` |
| `target_text_max` | `int` | `2000` |
| `target_other_min` | `int` | `1000` |
| `target_other_max` | `int` | `3000` |
| `repetition_k` | `int` | `16` |
| `code_short_line_threshold` | `int` | `60` |
| `code_punct_weight` | `float` | `0.5` |
| `code_short_line_weight` | `float` | `0.5` |
| `simhash_window` | `int` | `128` |
| `simhash_hamm_thresh` | `UnionType[int, NoneType]` | `None` |
| `enable_minhash` | `UnionType[bool, NoneType]` | `None` |
| `minhash_perms` | `UnionType[int, NoneType]` | `None` |
| `minhash_bands` | `UnionType[int, NoneType]` | `None` |
| `minhash_shingle_k` | `UnionType[int, NoneType]` | `None` |
| `minhash_jaccard_thresh` | `UnionType[float, NoneType]` | `None` |

## RepoContext

Optional repository-level context that sources and sinks may care about.

    All fields are optional by design to keep the contract stable.

    Attributes:
        repo_full_name (str | None): Repository name in ``owner/name`` form.
        repo_url (str | None): Canonical repository URL.
        license_id (str | None): SPDX-ish license identifier, if known.
        commit_sha (str | None): Commit hash or ref resolved for the source.
        extra (Mapping[str, Any] | None): Free-form metadata for downstream
            consumers.

| Field | Type | Default |
| --- | --- | --- |
| `repo_full_name` | `Union[str, NoneType]` | `None` |
| `repo_url` | `Union[str, NoneType]` | `None` |
| `license_id` | `Union[str, NoneType]` | `None` |
| `commit_sha` | `Union[str, NoneType]` | `None` |
| `extra` | `Union[Mapping[str, Any], NoneType]` | `None` |

## RunMetadata

Metadata describing a single Sievio run.

    This captures paths to primary outputs plus arbitrary user-defined
    key/value pairs under ``extra``.

| Field | Type | Default |
| --- | --- | --- |
| `primary_jsonl` | `Union[str, NoneType]` | `None` |
| `prompt_path` | `Union[str, NoneType]` | `None` |
| `repo_url` | `Union[str, NoneType]` | `None` |
| `extra` | `dict[str, Any]` | `<factory dict>` |

## SQLiteSourceConfig

Settings for reading text from SQLite databases.

    Attributes:
        default_text_columns (tuple[str, ...]): Column names that are
            treated as text fields by default.
        batch_size (int): Number of rows to fetch per query batch.
        download_max_bytes (int | None): Optional limit on bytes
            downloaded for remote databases.
        retries (int): Number of times to retry failed downloads.

| Field | Type | Default |
| --- | --- | --- |
| `default_text_columns` | `tuple[str, Ellipsis]` | `('text',)` |
| `batch_size` | `int` | `1000` |
| `download_max_bytes` | `Union[int, NoneType]` | `None` |
| `retries` | `int` | `2` |

## SafetyConfig

Safety/PII filtering configuration layered alongside QC screening.

    Safety uses QCMode-style strings ("inline", "advisory", "post", "off")
    but its mode is independent of QCConfig.mode. QC controls quality gating;
    SafetyConfig.mode together with annotate_only control safety gating.

| Field | Type | Default |
| --- | --- | --- |
| `enabled` | `bool` | `False` |
| `mode` | `str` | `'inline'` |
| `scorer` | `UnionType[Any, NoneType]` | `None` |
| `scorer_id` | `UnionType[str, NoneType]` | `None` |
| `scorer_options` | `dict[str, Any]` | `<factory dict>` |
| `toxicity_threshold` | `UnionType[float, NoneType]` | `None` |
| `allowed_licenses` | `UnionType[list[str], NoneType]` | `None` |
| `annotate_only` | `bool` | `False` |
| `fail_on_error` | `bool` | `False` |
| `write_csv` | `bool` | `False` |
| `csv_suffix` | `str` | `'_safety.csv'` |
| `write_signals_sidecar` | `bool` | `False` |
| `signals_suffix` | `UnionType[str, NoneType]` | `None` |
| `signals_format` | `Literal['csv', 'parquet']` | `'csv'` |
| `parallel_post` | `bool` | `False` |
| `post_executor_kind` | `UnionType[str, NoneType]` | `None` |
| `post_max_workers` | `UnionType[int, NoneType]` | `None` |
| `post_submit_window` | `UnionType[int, NoneType]` | `None` |

## SinkConfig

Top-level configuration for output sinks.

    Attributes:
        specs (list[SinkSpec]): Declarative sink specifications used by
            factories.
        sinks (Sequence[Sink]): Concrete sink instances, expected to be
            empty on purely declarative configs.
        context (RepoContext | None): Optional repository context passed
            to sinks.
        output_dir (Path): Base directory for sink outputs.
        primary_jsonl_name (str | None): Basename of the primary JSONL
            sink, if any.
        prompt (PromptConfig): Settings controlling prompt output.
        compress_jsonl (bool): Whether to gzip-compress JSONL outputs.
        jsonl_basename (str): Basename used for JSONL files.
        defaults (dict[str, dict[str, Any]]): Per-kind default options
            keyed by SinkSpec.kind.

| Field | Type | Default |
| --- | --- | --- |
| `specs` | `list[SinkSpec]` | `<factory list>` |
| `sinks` | `Sequence[Sink]` | `<factory tuple>` |
| `context` | `Union[RepoContext, NoneType]` | `None` |
| `output_dir` | `Path` | `PosixPath('.')` |
| `primary_jsonl_name` | `Union[str, NoneType]` | `None` |
| `prompt` | `PromptConfig` | `<factory PromptConfig>` |
| `compress_jsonl` | `bool` | `False` |
| `jsonl_basename` | `str` | `'data'` |
| `defaults` | `dict[str, dict[str, Any]]` | `<factory dict>` |

## SinkSpec

Declarative sink entry; factories map kind -> concrete sinks.

    Known kinds:
    - "default_jsonl_prompt": options jsonl_path, prompt_path
    - "parquet_dataset": options path (required), text_field/meta_field, partition_by,
      row_group_size, compression, overwrite

| Field | Type | Default |
| --- | --- | --- |
| `kind` | `str` | `required` |
| `options` | `dict[str, Any]` | `<factory dict>` |

## SourceConfig

Top-level configuration for all input sources.

    Attributes:
        specs (list[SourceSpec]): Declarative source specifications used
            by factories.
        sources (Sequence[Source]): Concrete source instances, expected
            to be empty on purely declarative configs.
        local (LocalDirSourceConfig): Defaults for local directory
            sources.
        github (GitHubSourceConfig): Defaults for GitHub sources.
        pdf (PdfSourceConfig): Defaults for web PDF sources.
        csv (CsvSourceConfig): Defaults for CSV sources.
        sqlite (SQLiteSourceConfig): Defaults for SQLite sources.
        defaults (dict[str, dict[str, Any]]): Per-kind default options
            keyed by SourceSpec.kind or plugin-defined ids.

| Field | Type | Default |
| --- | --- | --- |
| `specs` | `list[SourceSpec]` | `<factory list>` |
| `sources` | `Sequence[Source]` | `<factory tuple>` |
| `local` | `LocalDirSourceConfig` | `<factory LocalDirSourceConfig>` |
| `github` | `GitHubSourceConfig` | `<factory GitHubSourceConfig>` |
| `pdf` | `PdfSourceConfig` | `<factory PdfSourceConfig>` |
| `csv` | `CsvSourceConfig` | `<factory CsvSourceConfig>` |
| `sqlite` | `SQLiteSourceConfig` | `<factory SQLiteSourceConfig>` |
| `defaults` | `dict[str, dict[str, Any]]` | `<factory dict>` |

## SourceSpec

Declarative source entry; factories map kind -> concrete sources.

| Field | Type | Default |
| --- | --- | --- |
| `kind` | `str` | `required` |
| `options` | `dict[str, Any]` | `<factory dict>` |

